{{ define "main" }}
<main>
  <section class="p-strip--accent">
    <div class="row">
      <h2>{{.Title}}</h2>
      {{ with .OutputFormats.Get "Calendar" -}}
      <a rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}"><button>{{ i18n
          "ical_subscribe" }}</button></a>
      <a rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .RelPermalink | safeURL }}"><button>{{ i18n "ical_add"
          }}</button></a>
      {{- end }}
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <div id="calendar" style="height: 800px;"></div>
    </div>
  </section>
</main>
{{ $pages := .Site.Pages }}
{{ range .Site.Home.Translations }}
{{ $pages = $pages | lang.Merge .Site.Pages }}
{{ end }}
{{ $pages = (where $pages "Section" "sessions") }}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      // initialView: 'listDay',
      initialView: 'timeGridDay',
      initialDate: '2021-09-25',
      slotDuration: '00:05:00',
      slotMinTime: '13:00:00+09:00',
      validRange: {
        start: '2021-09-25',
        end: '2021-09-27'
      },
      eventClick: function(info) {
        window.location = info.event.url;
      },
      events: [
        {{ range $pages }}
        {{ if .Params.speakers }}
          {
            title: '{{.Title}} - {{range .Params.speakers}}{{.name}}; {{end}}',
            start: '{{dateFormat "2006-01-02T15:04:05-07:00" .Date.UTC}}',
            end: '{{dateFormat "2006-01-02T15:04:05-07:00" (time .Params.end).UTC}}',
            url: '{{.RelPermalink}}'
          },
        {{ end }}
        {{ end }}
      ]
    });
    calendar.render();
  });
</script>
{{ end }}